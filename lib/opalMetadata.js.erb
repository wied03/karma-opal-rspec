<%=
require 'opal/rspec'
require 'json'
require_relative 'sprockets_metadata'

non_watch_dep_graph = SprocketsMetadata.get_dependency_graph environment, %w{opal opal-rspec karma_formatter}
roll_up_list = %w{opal.rb opal-rspec.rb opal/rspec.rb}
non_watch_metadata = SprocketsMetadata.get_metadata non_watch_dep_graph, roll_up_list, watch=false
tests_dep_graph = SprocketsMetadata.get_dependency_graph environment, environment.get_opal_spec_requires
test_metadata = SprocketsMetadata.get_metadata tests_dep_graph, roll_up_list, watch=true

result = non_watch_metadata.merge(test_metadata)

result.to_json
%>
